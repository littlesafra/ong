---
title: "Proba"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

#conexion base de datos
install.packages("RMySQL")
library(DBI)
con <- dbConnect(RMySQL::MySQL(), user="root", host="localhost", password="", dbname="ikasbi")

#Paste0 para eliminar separacion // tener en cuenta los datos que se introducen 
myQuery <- myQuery <- paste0("INSERT INTO bazkideak (Izena) VALUES ('", data,"')")
dbSendQuery(con,myQuery)

install.packages("readxl")
library("readxl")

envios_data <- read_excel("/Users/Elena/Desktop/datos1.xls")
mancomunidades_data <- read.csv("/Users/Elena/Desktop/Proyecto.csv", head=TRUE)
mancomunidades_scaled <- scale(mancomunidades_data)



library(mlbench)
summary_habitantes <- habitantes_data
summary_envios <- envios_data

library(D)
library(RMySQL)
mydb = dbConnect(MySQL(), user="root", host="localhost", password="password", dbname="database_ong")
#borrar variables de entorno
remove(list = ls())

#leer fichero
library("readxl")
data <- read_excel("/Users/Elena/Desktop/proba.xls")

#Escalar datos(valor neutro)
data.scale <- scale(data[,2:6])

set.seed(80)
data.km <- kmeans(data.scale,centers = 4)

#contenido del objeto
names(data.km)

#asignaciones del cluster
data.km$cluster

#a침adimos clusters a la tabla
data$Cluster <- data.km$cluster


#filtramos por grupos
library(dplyr)
grupo1 <- filter(data, data$Cluster == 1)
grupo2 <- filter(data, data$Cluster == 2)
grupo3 <- filter(data, data$Cluster == 3)
grupo4 <- filter(data, data$Cluster == 4)

#creamos una tabla por grupo, con las medias correspondientes
Poblacion1 <- sum(grupo1$Poblacion)
Renta_Personal <- mean(grupo1$Renta_Personal)
Renta_Familiar <- mean(grupo1$Renta_Familiar)
Renta_Mixta <- (Renta_Personal/Renta_Familiar * 100)
Poblacion_total <- sum(data$Poblacion)

#Grupo1
Renta_Personal, Renta_Familiar, Renta_Mixta))
Renta_Personal <- mean(grupo1$Renta_Personal)
Renta_Familiar <- mean(grupo1$Renta_Familiar)
Renta_Mixta <- (Renta_Personal/Renta_Familiar * 100)
grupo1.medias <- data.frame(cbind(Poblacion1, Renta_Personal, Renta_Familiar, Renta_Mixta))
grupo1.medias$porcentajePoblacion <- Poblacion1 * 100 / Poblacion_total


#Grupo2
Poblacion2 <- sum(grupo2$Poblacion)
Renta_Personal <- mean(grupo2$Renta_Personal)
Renta_Familiar <- mean(grupo2$Renta_Familiar)
Renta_Mixta <- (Renta_Personal/Renta_Familiar * 100)
grupo2.medias <- data.frame(cbind(Poblacion2, Renta_Personal, Renta_Familiar, Renta_Mixta))
grupo2.medias$porcentajePoblacion <- Poblacion2 * 100 / Poblacion_total

#Grupo3
Poblacion3 <- sum(grupo3$Poblacion)
Renta_Personal <- mean(grupo3$Renta_Personal)
Renta_Familiar <- mean(grupo3$Renta_Familiar)
Renta_Mixta <- (Renta_Personal/Renta_Familiar * 100)
grupo3.medias <- data.frame(cbind(Poblacion3, Renta_Personal, Renta_Familiar, Renta_Mixta))
grupo3.medias$porcentajePoblacion <- Poblacion3 * 100 / Poblacion_total

#Grupo4
Poblacion4 <- sum(grupo4$Poblacion)
Renta_Personal <- mean(grupo4$Renta_Personal)
Renta_Familiar <- mean(grupo4$Renta_Familiar)
Renta_Mixta <- (Renta_Personal/Renta_Familiar * 100)
grupo4.medias <- data.frame(cbind(Poblacion4, Renta_Personal, Renta_Familiar, Renta_Mixta))
grupo4.medias$porcentajePoblacion <- Poblacion4 * 100 / Poblacion_total

#TablaMediasGrupos
medias.total <- data.frame(rbind(as.matrix(grupo1.medias), as.matrix(grupo2.medias),as.matrix(grupo3.medias),as.matrix(grupo4.medias)))

#Redondeamos los decimales a 4, porque sino, qplot da error
medias.total$Renta_Mixta <- lapply(medias.total$Renta_Mixta, round, 0)
medias.total$Poblacion1 <- lapply(medias.total$Poblacion1, round, 0)


#Mostramos un gr치fico XY con la poblaci칩n por
plot(medias.total$Renta_Mixta,medias.total$Poblacion1, ylab="% Renta Mixta", xlab="% Poblaci칩n", col="Red")


